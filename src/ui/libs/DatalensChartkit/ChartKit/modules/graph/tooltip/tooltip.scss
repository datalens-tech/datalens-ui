$rowPadding: 14px;
$lastTDRightPadding: 18px;
$defaultScrollbarWidth: 15px;
$valuePaddingLeft: 12px;
$monospaceFontFamily: 'Consolas', 'Menlo', 'Ubuntu Mono', monospace;

@mixin monospaceFont {
    font-family: $monospaceFontFamily;
    word-spacing: -3px;
}

// If a scroll appears in the tooltip (with a large number of lines and after fixing), it is necessary to change the paddings of some elements to the width of the scrollbar.
// due to this, in the ideal case (when there is no row with a width exceeding the maximum width of one of the rows visible before fixing among the rows that appeared after fixing the tooltip),
// we can avoid a "jump" in the width of the container.
// Since the behavior of scrollbars in Safari (the scrollbar does not change the width of the container)
// and in other browsers (where the scrollbar that appears adds its width to the container), separate styles are needed for
// Safari

.chartkit-highcharts-tooltip-container {
    &_type_timeline {
        width: 100%;
        height: 100%;
    }

    &._tooltip-with-scroll {
        ._tooltip-header td:last-child {
            padding-right: calc(
                #{$lastTDRightPadding} + var(--g-scrollbar-width, #{$defaultScrollbarWidth})
            );
        }

        ._tooltip-footer td:last-child {
            padding-right: calc(
                #{$lastTDRightPadding} + var(--g-scrollbar-width, #{$defaultScrollbarWidth})
            );
        }
    }

    &._tooltip-with-scroll-in-safari {
        ._tooltip-row td:last-child {
            padding-right: calc(
                #{$lastTDRightPadding} + var(--g-scrollbar-width, #{$defaultScrollbarWidth})
            );
        }

        ._tooltip-rows__summ-tr td:last-child {
            padding-right: calc(
                #{$lastTDRightPadding} + var(--g-scrollbar-width, #{$defaultScrollbarWidth})
            );
        }
    }
}

._tooltip {
    overflow: hidden;

    box-sizing: border-box;

    font-size: 12px;

    color: var(--highcharts-tooltip-text);
    border-radius: 5px;
    background: var(--highcharts-tooltip-bg);
    box-shadow: 0px 2px 12px rgba(0, 0, 0, 0.15);

    // iPhone-specific indent with rounded corners
    // if the max css function is not supported - the style block will not be executed and the padding specified above will be applied
    // https://webkit.org/blog/7929/designing-websites-for-iphone-x/
    @supports (padding: max(0px)) {
        &_split-tooltip {
            padding-bottom: Max(12px, env(safe-area-inset-bottom));
        }
    }

    &_split-tooltip {
        padding-bottom: 12px;

        border: none;
        border-radius: 0;
        box-shadow: none;

        table {
            table-layout: fixed;
        }

        ._tooltip-rows__table tbody {
            display: table-row-group;
        }
    }

    table {
        width: 100%;

        td {
            box-sizing: border-box;
        }

        td:last-child {
            text-align: right;
        }
    }

    &-fake-row {
        height: 5px;

        &-heightless {
            height: 0;

            td {
                padding: 0;
            }
        }

        td:first-child {
            width: 28px;
        }
    }

    &-row {
        width: 100%;

        td:first-child {
            padding-left: $rowPadding;
        }

        td:last-child {
            padding-right: $lastTDRightPadding;
        }

        td {
            padding: 2px 4px;

            &._tooltip-rows__value-td,
            &._tooltip-rows__diff-td {
                padding-bottom: 1px;
            }
        }
    }

    &-selected-row {
        font-weight: 600;
    }

    &-comment-row {
        td:last-child {
            padding-right: $lastTDRightPadding;
        }
    }

    &-right__td {
        padding-right: $rowPadding;

        &_with-split-tooltip {
            border: none;
        }
    }

    &-date {
        overflow: hidden;

        max-width: 450px;
        padding: 10px $rowPadding 4px;

        font-size: 13px;
        font-weight: bold;
        white-space: nowrap;
        text-overflow: ellipsis;

        &-dayofweek {
            display: inline-block;

            &_weekend {
                color: #ff0000;
            }
        }
    }

    &-rows {
        &__table {
            width: 10px;

            border-spacing: 0;

            &-footer {
                display: table;

                width: 100%;
            }

            thead {
                display: table;

                width: 100%;

                &._tooltip-header tr:not(._tooltip-fake-row):first-child td {
                    padding-top: 6px;
                    padding-bottom: 6px;

                    border-bottom: 1px solid var(--highcharts-grid-line);
                }
            }

            tbody {
                display: block;
                overflow-x: hidden;
                overflow-y: auto;

                &._tooltip-footer {
                    display: table;

                    width: 100%;
                }

                &._tooltip-list {
                    overflow-x: hidden;

                    ._tooltip-row-dark-bg {
                        background-color: var(--highcharts-tooltip-alternate-bg);
                    }
                }

                ._hidden-rows-sum {
                    &._hidden-rows-sum-dark-bg {
                        background-color: var(--highcharts-tooltip-alternate-bg);
                    }

                    td {
                        padding-top: 2px;
                        padding-bottom: 2px;
                    }
                }

                td._hidden-rows-number {
                    padding-right: 20px;

                    text-align: left;
                }

                td._hidden-rows-value {
                    @include monospaceFont;
                }
            }
        }

        &__bubble {
            &-div {
                display: inline-block;

                width: 12px;
                height: 6px;
                margin-bottom: 1px;
                margin-left: 1px;

                border-radius: 1px;
            }
        }

        &__shape-div {
            display: flex;
            align-items: center;

            width: 38px;
            height: 100%;
        }

        &__shape-td {
            height: 20px;
        }

        &__percent-td {
            padding-left: $valuePaddingLeft;

            white-space: nowrap;
            @include monospaceFont;
        }

        &__diff-td {
            padding-right: 3px;
            padding-left: 3px;

            white-space: nowrap;
            @include monospaceFont;
        }

        &__comment-left {
            &-td {
                position: relative;
            }

            &-div {
                position: absolute;
                top: -7px;
                bottom: 6px;
                left: 2px;

                width: 10px;
            }
        }

        &__comment-div {
            position: relative;

            width: auto;
            padding-left: 14px;

            font-size: 10px;
            font-weight: normal;
            line-height: 1.3;
            text-align: left;
            white-space: normal;
            letter-spacing: 0.2px;

            color: #aaaaaa;
        }

        &__bubble-td {
            width: 28px;
        }

        &__value-td {
            padding-left: $valuePaddingLeft;

            white-space: nowrap;
            @include monospaceFont;

            &_selected {
                text-decoration: underline;
            }
        }

        &__name-td {
            overflow: hidden;

            max-width: 400px;
            padding-left: 10px;

            text-align: left;
            white-space: nowrap;
            text-overflow: ellipsis;

            &_selected {
                text-decoration: underline;
            }
        }

        &__summ-td {
            padding: 6px 0 6px 3px;

            font-size: 12px;

            color: var(--highcharts-tooltip-text-complementary);
            border-top: 1px solid var(--highcharts-grid-line);

            &-value {
                @include monospaceFont;
            }

            &:first-child {
                padding-left: 15px;

                text-align: left;
            }

            &:last-child {
                padding-right: $lastTDRightPadding;

                text-align: right;
            }
        }
    }

    &-left {
        &__td {
            vertical-align: top;
        }
    }

    &-right {
        &__td {
            position: relative;

            min-width: 120px;
            max-width: 150px;
            padding-left: 10px;

            font-size: 8pt;
            vertical-align: top;
            white-space: normal;

            opacity: 0.9;
            border-left: 1px solid var(--highcharts-grid-line);
        }

        &__holiday {
            &-div {
                display: flex;
                align-items: center;

                padding-bottom: 5px;

                text-align: left;
            }

            &-emoji {
                font-size: 20px;
            }

            &-region {
                display: inline-block;

                padding-left: 5px;

                letter-spacing: 1px;

                color: #ffffff;
            }
        }

        &__traf-div {
            margin-top: 9px;
            padding-top: 3px;
            padding-bottom: 10px;

            font-size: 10px;
            line-height: 1.3;
            text-align: left;
            white-space: pre-line;
            word-break: break-word;

            border-top: 3px solid;

            &_for-split-tooltip {
                margin-top: 0;
                margin-bottom: 5px;
                margin-left: 6px;
                padding-top: 0;
                padding-bottom: 0;
                padding-left: 8px;

                color: var(--g-color-text-secondary);
                border-top: none;
                border-left: 2px solid;
            }

            &:not(:first-child) {
                margin-top: 7px;
            }
        }

        &__margin-bot {
            margin-bottom: 7px;
        }
    }
}
